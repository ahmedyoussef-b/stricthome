// src/components/session/ParticipantList.tsx
'use client';

import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Users, Wifi, WifiOff } from 'lucide-react';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { StudentWithCareer } from '@/lib/types';
import { Role } from '@prisma/client';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '../ui/tooltip';
import { cn } from '@/lib/utils';

type SessionParticipant = (StudentWithCareer | (any & { role: Role })) & { role: Role };


interface ParticipantListProps {
    allSessionUsers: SessionParticipant[];
    onlineUserIds: string[];
    currentUserId: string;
}

export function ParticipantList({ allSessionUsers, onlineUserIds, currentUserId }: ParticipantListProps) {
    return (
        <Card className="flex-1 flex flex-col min-h-0">
            <CardHeader>
                <CardTitle className="flex items-center gap-2 text-base">
                    <Users /> Participants ({allSessionUsers.length})
                </CardTitle>
            </CardHeader>
            <CardContent className="space-y-3 overflow-y-auto pr-2">
              <TooltipProvider>
                {allSessionUsers.map(user => {
                    const isOnline = onlineUserIds.includes(user.id);
                    return (
                        <div key={user.id} className="flex items-center justify-between gap-3">
                            <div className='flex items-center gap-3'>
                                <Avatar className="h-8 w-8">
                                    <AvatarFallback>{user?.name?.charAt(0) ?? '?'}</AvatarFallback>
                                </Avatar>
                                <span className={cn("text-sm font-medium", !isOnline && "text-muted-foreground")}>
                                    {user.name ?? 'Utilisateur'} {user.id === currentUserId ? '(Vous)' : ''}
                                </span>
                            </div>
                             <Tooltip>
                                <TooltipTrigger>
                                     {isOnline ? <Wifi className="h-4 w-4 text-green-500" /> : <WifiOff className="h-4 w-4 text-muted-foreground" />}
                                </TooltipTrigger>
                                <TooltipContent>
                                    <p>{isOnline ? 'En ligne' : 'Hors ligne'}</p>
                                </TooltipContent>
                            </Tooltip>
                        </div>
                    )
                })}
              </TooltipProvider>
            </CardContent>
        </Card>
    );
}
